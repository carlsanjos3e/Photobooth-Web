<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Photobooth</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        video, canvas { border: 2px solid black; margin-top: 10px; display: block; margin-left: auto; margin-right: auto; }
        button { margin: 10px; padding: 10px; font-size: 16px; }
        #countdown { font-size: 24px; font-weight: bold; color: red; margin-top: 10px; }
        #flash { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: white; 
            opacity: 0; 
            pointer-events: none;
            transition: opacity 0.3s;
        }
        #video, #canvas { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Simple Photobooth</h1>
    <button onclick="startCamera()">Start Camera</button>
    <button onclick="startPhotoSequence()">Start 4-Shot Sequence</button>
    <button onclick="downloadAllPhotos()">Download Individual Photos</button>
    <button onclick="downloadCollage()">Download Collage</button>
    <br>
    <div id="countdown"></div>
    <video id="video" width="400" height="300" autoplay></video>
    <canvas id="canvas" width="400" height="300" style="display:none;"></canvas>
    <canvas id="collageCanvas" width="400" height="1200"></canvas>
    <div id="flash"></div>
    <script>
        let video = document.getElementById('video');
        let canvas = document.getElementById('canvas');
        let collageCanvas = document.getElementById('collageCanvas');
        let ctx = canvas.getContext('2d');
        let collageCtx = collageCanvas.getContext('2d');
        let countdown = document.getElementById('countdown');
        let flash = document.getElementById('flash');
        let shotCount = 0; // Track number of shots
        let capturedPhotos = []; // Store captured images

        function startCamera() {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => { video.srcObject = stream; })
                .catch(err => { alert('Error accessing camera: ' + err); });
        }

        function startPhotoSequence() {
            shotCount = 0; // Reset counter before starting
            capturedPhotos = []; // Clear previous photos
            collageCtx.clearRect(0, 0, collageCanvas.width, collageCanvas.height); // Reset collage
            takePhotoWithDelay();
        }

        function takePhotoWithDelay() {
            if (shotCount < 4) { // Ensure only 4 shots are taken
                let timeLeft = 5;
                countdown.innerText = timeLeft;
                let countdownInterval = setInterval(() => {
                    timeLeft--;
                    countdown.innerText = timeLeft;
                    if (timeLeft <= 0) {
                        clearInterval(countdownInterval);
                        countdown.innerText = '';
                        capturePhoto();
                        shotCount++;
                        
                        // Show live video again before the next shot
                        if (shotCount < 4) {
                            video.style.display = 'block';
                            canvas.style.display = 'none';
                            takePhotoWithDelay(); // Recursive call for next shot
                        }
                    }
                }, 1000);
            }
        }

        function capturePhoto() {
            flash.style.opacity = '1'; // Show flash effect
            setTimeout(() => { flash.style.opacity = '0'; }, 200); // Hide flash quickly
            
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            canvas.style.display = 'block';
            video.style.display = 'none';
            let photoData = canvas.toDataURL('image/png');
            capturedPhotos.push(photoData); // Save photo
            updateCollage(photoData, shotCount); // Update collage preview
        }

        function updateCollage(photo, index) {
            let img = new Image();
            img.src = photo;
            img.onload = () => {
                collageCtx.drawImage(img, 0, index * 300, 400, 300); // Positioning each photo in the collage
            };
        }

        function downloadAllPhotos() {
            capturedPhotos.forEach((photo, index) => {
                let link = document.createElement('a');
                link.href = photo;
                link.download = `photo_${index + 1}.png`;
                link.click();
            });
        }

        function downloadCollage() {
            if (capturedPhotos.length === 4) {
                let link = document.createElement('a');
                link.href = collageCanvas.toDataURL('image/png');
                link.download = 'photo_collage.png';
                link.click();
            } else {
                alert('Please complete all 4 shots before downloading the collage.');
            }
        }
    </script>
</body>
</html>
